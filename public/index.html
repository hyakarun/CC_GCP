<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Å°„Åá„ÅÑ„Å∑„Å°„Å∑„Åü„ÉºÔºà„ÉÜ„Çπ„ÉàÔºâ</title>
    <link rel="stylesheet" href="css/style.css?v=skill_ui_v10_small_icons">
    <link rel="icon" href="images/slime.png">
    <script>
        window.onerror = function(msg, url, line, col, error) {
            const errorMsg = "JS Error: " + msg + "\nURL: " + url + "\nL: " + line + ":" + col;
            console.error(errorMsg);
            if (!window.location.hostname.includes('localhost')) {
                // Add to body instead of alert to be less intrusive but visible
                const div = document.createElement('div');
                div.style.position = 'fixed'; div.style.bottom = '0'; div.style.left = '0'; 
                div.style.background = 'rgba(255,0,0,0.8)'; div.style.color = 'white';
                div.style.padding = '10px'; div.style.zIndex = '10000'; div.style.fontSize = '12px';
                div.innerText = errorMsg;
                document.body.appendChild(div);
            }
            return false;
        };
    </script>
</head>

<body>

    <div id="login-overlay" style="display: none;">
        <div class="login-box">
            <img src="images/logo_bk_1st.png" alt="Logo" class="login-logo">
            <h2 id="login-title">„É≠„Ç∞„Ç§„É≥</h2>
            <input type="text" id="name" placeholder="„Éó„É¨„Ç§„É§„ÉºÂêç" class="hidden">
            <input type="email" id="email" placeholder="„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ">
            <input type="password" id="password" placeholder="„Éë„Çπ„ÉØ„Éº„Éâ">
            <p id="login-error" class="error-msg"></p>

            <div id="btn-group-login">
                <button onclick="doLogin()">„É≠„Ç∞„Ç§„É≥</button>
                <button class="secondary" onclick="toggleMode()">Êñ∞Ë¶èÁôªÈå≤„Å∏</button>
            </div>

            <div id="btn-group-register" class="hidden">
                <button onclick="doRegister()" style="background-color:#2ecc71;">ÁôªÈå≤„Åô„Çã</button>
                <button class="secondary" onclick="toggleMode()">„É≠„Ç∞„Ç§„É≥„Å∏Êàª„Çã</button>
            </div>
        </div>
    </div>

    <div id="offline-result-overlay" class="overlay" style="display: none;">
        <div class="dialog-box">
            <h3>„Åä„Åã„Åà„Çä„Å™„Åï„ÅÑÔºÅ</h3>
            <p>„Ç™„Éï„É©„Ç§„É≥ÊúüÈñì„ÅÆÊàêÊûú:</p>
            <div class="result-row">ÁµåÈÅéÊôÇÈñì: <span id="offline-time">0</span>Áßí</div>
            <div class="result-row">ÂÄí„Åó„ÅüÊïµ: <span id="offline-kills">0</span>‰Ωì</div>
            <div class="result-row">Áç≤ÂæóÁµåÈ®ìÂÄ§: <span id="offline-exp">0</span></div>
            <button onclick="closeOfflineDialog()"
                style="margin-top:15px; width:100%; padding:8px; cursor:pointer;">OK</button>
        </div>
    </div>

    <!-- Ë£ÖÂÇôÂâäÈô§Á¢∫Ë™ç„ÉÄ„Ç§„Ç¢„É≠„Ç∞ -->
    <div id="delete-confirm-overlay" class="overlay" style="display: none;">
        <div class="dialog-box" style="width: 320px;">
            <h3 style="color:#e74c3c; border-color:#e74c3c;">Ë£ÖÂÇô„ÇíÊç®„Å¶„Åæ„Åô„ÅãÔºü</h3>
            <p id="delete-target-name" style="font-weight:bold; margin:15px 0;">„Ç¢„Ç§„ÉÜ„É†Âêç</p>
            <p style="font-size:12px; color:#666;">„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ</p>

            <div
                style="margin: 15px 0; text-align:left; font-size:13px; background:#f9f9f9; padding:10px; border-radius:4px;">
                <label style="cursor:pointer; display:flex; align-items:center;">
                    <input type="checkbox" id="chk-skip-confirm" style="width:auto; margin-right:8px;">
                    ‰ªäÂæå15ÂàÜÈñì„ÅØÁ¢∫Ë™ç„Åõ„Åö„Å´Êç®„Å¶„Çã
                </label>
            </div>

            <div style="display:flex; gap:10px; justify-content:center;">
                <button onclick="executeDelete(document.getElementById('chk-skip-confirm').checked)"
                    style="background-color:#e74c3c; color:white; border:none; padding:8px 20px; border-radius:4px; cursor:pointer; font-weight:bold;">Êç®„Å¶„Çã</button>
                <button onclick="closeDeleteDialog()"
                    style="background-color:#95a5a6; color:white; border:none; padding:8px 20px; border-radius:4px; cursor:pointer; font-weight:bold;">„Ç≠„É£„É≥„Çª„É´</button>
            </div>
        </div>
    </div>

    <div id="adventure-overlay" class="overlay" style="display: none;">
        <div id="adventure-window" class="adv-popup-window">
            <!-- „Ç≠„É£„É©„ÇØ„Çø„ÉºÂ∑¶Âè≥ -->
            <div id="adv-char-container" style="position: absolute; width: 100%; height: 100%; pointer-events: none;">
                <img id="adv-char-left" src=""
                    style="position: absolute; bottom: 60px; left: 0%; height: 42.5%; display: none; filter: drop-shadow(0 0 10px rgba(0,0,0,0.5));">
                <img id="adv-char-right" src=""
                    style="position: absolute; bottom: 60px; right: 0%; height: 42.5%; display: none; transform: scaleX(-1); filter: drop-shadow(0 0 10px rgba(0,0,0,0.5));">
            </div>

            <!-- „É°„ÉÉ„Çª„Éº„Ç∏„Ç¶„Ç£„É≥„Éâ„Ç¶ -->
            <div id="adv-msg-window" class="adv-window" onclick="nextAdventureMsg()">
                <div id="adv-name-tag" class="adv-name-tag">ÂêçÂâç</div>
                <div id="adv-msg-text" class="adv-msg-text">„Åì„Åì„Å´„É°„ÉÉ„Çª„Éº„Ç∏„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô„ÄÇ</div>
                <div class="adv-next-arrow">‚ñº</div>
            </div>
        </div>
    </div>

    <div id="game-container" style="display:none;">

        <div id="combat-area" style="position:relative;">
            <canvas id="gameCanvas"></canvas>
            <div id="combat-log"></div>
            <button id="debug-speed-btn" onclick="toggleSpeed()"
                style="position:absolute; top:10px; left:220px; z-index:10; padding:5px 10px; background:rgba(0,0,0,0.5); color:white; border:1px solid #fff; cursor:pointer;">x1</button>

            <!-- „Çπ„Ç≠„É´„ÇØ„Éº„É´„Çø„Ç§„É†Ë°®Á§∫ (Â∑¶‰∏ã) -->
            <div id="combat-skill-container">
                <!-- JSÂÅ¥„ÅßÂãïÁöÑ„Å´„Ç¢„Ç§„Ç≥„É≥„ÇíÁîüÊàê -->
            </div>
        </div>

        <div id="bottom-area">
            <div id="menu-area">
                <div class="menu-item active" onclick="switchScreen('status')" id="menu-status">„Çπ„ÉÜ„Éº„Çø„Çπ</div>
                <div class="menu-item" onclick="switchScreen('skill')" id="menu-skill">„Çπ„Ç≠„É´</div>
                <div class="menu-item" onclick="switchScreen('story')" id="menu-story" style="display:none;">„Çπ„Éà„Éº„É™„Éº</div>
                <div class="menu-item" onclick="switchScreen('dungeon')" id="menu-dungeon">„ÉÄ„É≥„Ç∏„Éß„É≥</div>
                <div class="menu-item" onclick="switchScreen('job')" id="menu-job">ËÅ∑Ê•≠</div>
                <div class="menu-item" onclick="switchScreen('equipment')" id="menu-equipment">Ë£ÖÂÇô</div>
                <div class="menu-item" onclick="openNews()" style="margin-top:auto; background-color:#3498db; position: relative;">
                    „ÅäÁü•„Çâ„Åõ
                    <div id="news-badge" class="news-badge"></div>
                </div>
                <div class="menu-item" onclick="doLogout()" style="background-color:#c0392b;">„É≠„Ç∞„Ç¢„Ç¶„Éà</div>
            </div>

            <div id="info-area">
            </div>

            <div id="details-area">

                <div id="screen-status" class="screen-content">
                    <div id="top-stats-row" class="status-block header-stats">
                        <div class="status-row">
                            <span id="val-name" style="margin-right:10px; font-weight:bold;"></span>
                            <span class="label">Lv:</span> <span id="val-lv" class="val-big">1</span>
                            <span style="font-size:14px; color:black; text-shadow:none; margin-left: auto;">
                                <span id="val-money">0</span> Mumel
                            </span>
                        </div>
                        <div class="status-row">
                            <span class="label">HP:</span>
                            <span class="status-values">
                                <span id="val-hp">100</span> / <span id="val-max-hp">100</span>
                            </span>
                            <div class="bar-container">
                                <div id="bar-hp" class="bar-fill hp-bar" style="width: 100%;"></div>
                            </div>
                        </div>
                        <div class="status-row">
                            <span class="label">EXP:</span>
                            <span class="status-values">
                                <span id="val-exp">0</span> / <span id="val-next-exp">100</span>
                            </span>
                            <div class="bar-container">
                                <div id="bar-exp" class="bar-fill exp-bar" style="width: 0%;"></div>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <div class="status-section">
                        <h3>Âü∫Á§é„Çπ„ÉÜ„Éº„Çø„Çπ (ÊÆã„ÇäSP: <span id="val-sp" class="highlight">0</span>)</h3>
                        <div class="stats-grid base-stats">
                            <div class="stat-item"><span class="stat-name">STR</span> <span id="val-str"
                                    class="stat-val">5</span> <button class="btn-plus"
                                    onclick="addStat('str')">+</button></div>
                            <div class="stat-item"><span class="stat-name">VIT</span> <span id="val-vit"
                                    class="stat-val">5</span> <button class="btn-plus"
                                    onclick="addStat('vit')">+</button></div>
                            <div class="stat-item"><span class="stat-name">AGI</span> <span id="val-agi"
                                    class="stat-val">5</span> <button class="btn-plus"
                                    onclick="addStat('agi')">+</button></div>
                            <div class="stat-item"><span class="stat-name">INT</span> <span id="val-int"
                                    class="stat-val">5</span> <button class="btn-plus"
                                    onclick="addStat('int')">+</button></div>
                            <div class="stat-item"><span class="stat-name">DEX</span> <span id="val-dex"
                                    class="stat-val">5</span> <button class="btn-plus"
                                    onclick="addStat('dex')">+</button></div>
                            <div class="stat-item"><span class="stat-name">LUK</span> <span id="val-luk"
                                    class="stat-val">5</span> <button class="btn-plus"
                                    onclick="addStat('luk')">+</button></div>
                        </div>
                    </div>

                    <div class="status-section">
                        <h3>Êà¶ÈóòËÉΩÂäõ</h3>
                        <div class="stats-grid battle-stats">
                            <div class="stat-item-read">ATK: <span id="val-atk">0</span></div>
                            <div class="stat-item-read">MATK: <span id="val-matk">0</span></div>
                            <div class="stat-item-read">DEF: <span id="val-def">0</span></div>
                            <div class="stat-item-read">MDEF: <span id="val-mdef">0</span></div>
                            <div class="stat-item-read">HIT: <span id="val-hit">0</span></div>
                            <div class="stat-item-read">EVA: <span id="val-eva">0</span></div>
                            <div class="stat-item-read">CRI: <span id="val-cri">0</span>%</div>
                            <div class="stat-item-read">RES: <span id="val-res">0</span></div>
                        </div>
                    </div>
                    <div id="reset-section" class="status-section"
                        style="display:none; margin-top: 30px; border-top: 1px solid #ccc; padding-top: 20px;">
                        <button onclick="confirmReset()"
                            style="background-color: #e74c3c; color: white; border: none; padding: 10px 15px; border-radius: 4px; cursor: pointer; font-weight: bold; width: 100%;">ÊúÄÂàù„Åã„Çâ„ÇÑ„ÇäÁõ¥„ÅôÔºà„Çª„Éº„Éñ„Éá„Éº„ÇøÊ∂àÂéªÔºâ</button>
                    </div>
                </div>

                <!-- „Çπ„Ç≠„É´ÁîªÈù¢ -->
                <div id="screen-skill" class="screen-content" style="display: none;">
                    <!-- JSÂÅ¥„ÅßÂãïÁöÑ„Å´ÁîüÊàê -->
                </div>

                <div id="screen-story" class="screen-content" style="display: none;">
                    <div class="story-tabs">
                        <button class="tab-btn active" onclick="switchStoryTab('main')" id="story-tab-main">„É°„Ç§„É≥</button>
                        <button class="tab-btn" onclick="switchStoryTab('sub')" id="story-tab-sub">„Çµ„Éñ</button>
                    </div>
                    <div id="story-list-container" class="story-list" style="padding: 20px;">
                        <p id="story-placeholder-text">„É°„Ç§„É≥„Çπ„Éà„Éº„É™„Éº„ÅØÁèæÂú®Ê∫ñÂÇô‰∏≠„Åß„Åô„ÄÇ</p>
                    </div>
                </div>


                <div id="screen-dungeon" class="screen-content" style="display: none;">
                    <div class="dungeon-tabs">
                        <button class="tab-btn active" onclick="switchDungeonTab('normal')"
                            id="tab-normal">ÈÄöÂ∏∏„ÉÄ„É≥„Ç∏„Éß„É≥</button>
                        <button class="tab-btn" onclick="switchDungeonTab('event')" id="tab-event">„Ç§„Éô„É≥„Éà„ÉÄ„É≥„Ç∏„Éß„É≥</button>
                    </div>
                    <div class="dungeon-list">
                        <p style="text-align:center; padding:20px; color:#666;">„ÉÄ„É≥„Ç∏„Éß„É≥„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø‰∏≠...</p>
                    </div>
                </div>

                <!-- ËÅ∑Ê•≠ÁîªÈù¢ -->
                <div id="screen-job" class="screen-content"
                    style="display:none; flex-direction: column; overflow: hidden;">

                    <!-- 1. ËÅ∑Ê•≠Êú™ÈÅ∏Êäû„ÉªËª¢ËÅ∑Áî®„Éì„É•„Éº -->
                    <div id="job-selection-view" style="display: flex; flex-direction: column; flex: 1; min-height: 0;">
                        <h3 style="border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-bottom: 10px;">ËÅ∑Ê•≠Ë®≠ÂÆö
                        </h3>
                        <div class="job-container" style="display: flex; gap: 20px; flex: 1; min-height: 0;">
                            <!-- ËÅ∑Ê•≠„Ç´„ÉÜ„Ç¥„É™Â∑¶„É°„Éã„É•„Éº -->
                            <div class="job-sidebar"
                                style="width: 200px; border-right: 1px solid #ddd; padding-right: 15px; display: flex; flex-direction: column; gap: 10px;">
                                <button class="job-cat-btn active" onclick="switchJobCategory('crafter')"
                                    id="job-cat-crafter">„ÇØ„É©„Éï„Çø„Éº</button>
                                <button class="job-cat-btn" onclick="switchJobCategory('gatherer')"
                                    id="job-cat-gatherer">„ÇÆ„É£„Ç∂„É©„Éº</button>
                                <button class="job-cat-btn" onclick="switchJobCategory('farmer')"
                                    id="job-cat-farmer">„Éï„Ç°„Éº„Éû„Éº</button>
                            </div>

                            <!-- ËÅ∑Ê•≠„É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
                            <div class="job-main-content"
                                style="flex: 1; overflow-y: auto; padding-left: 5px; display: flex; flex-direction: column;">
                                <div id="job-category-desc"
                                    style="background: #f0f8ff; padding: 8px 12px; border-radius: 8px; margin-bottom: 10px; border-left: 5px solid #3498db;">
                                    <h4 id="job-cat-title" style="margin-top: 0; margin-bottom: 5px;">„ÇØ„É©„Éï„Çø„Éº</h4>
                                    <p id="job-cat-text"
                                        style="font-size: 14px; color: #333; line-height: 1.4; margin: 0;">
                                        Á¥†Êùê„ÇíÂä†Â∑•„Åó„ÄÅÊ≠¶ÂÖ∑„ÇÑÈÅìÂÖ∑„ÇíÂâµ„ÇäÂá∫„ÅôËÅ∑‰∫∫„Åü„Å°„ÅÆ„Ç´„ÉÜ„Ç¥„É™„Éº„ÄÇÁµåÊ∏à„ÅÆÂæ™Áí∞„ÇíÊîØ„Åà„Çã‰∏≠ÂøÉÁöÑ„Å™ÂΩπÂâ≤„ÇíÊãÖ„ÅÑ„Åæ„Åô„ÄÇ</p>
                                </div>

                                <div id="job-list-container" style="flex: 1; display: flex; flex-direction: column;">
                                    <h4 style="margin: 4px 0;">ÈÅ∏ÊäûÂèØËÉΩ„Å™ËÅ∑Ê•≠</h4>
                                    <div id="job-list"
                                        style="display:grid; grid-template-columns: repeat(auto-fill, minmax(225px, 1fr)); gap:15px; margin-top:5px; flex: 1;">
                                        <!-- „Ç´„ÉÜ„Ç¥„É™„Å´Âøú„Åò„ÅüËÅ∑Ê•≠„Ç´„Éº„Éâ„Åå„Åì„Åì„Å´ÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Çã -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 2. ËÅ∑Ê•≠Â∞ÇÁî®„Éì„É•„Éº (Â∞±Ê•≠‰∏≠) -->
                    <div id="job-specific-view"
                        style="display:none; flex: 1; flex-direction: column; overflow-y: auto; padding: 10px;">
                        <div
                            style="background: #fff; border: 1px solid #ddd; border-top: 4px solid #3498db; border-radius: 8px; padding: 20px; text-align: center;">
                            <h2 id="job-spec-title" style="color: #2c3e50; margin-bottom: 10px;">ËÅ∑Ê•≠Âêç</h2>
                            <p style="color: #666; font-size: 14px; margin-bottom: 30px;">
                                „Åì„Åì„ÅØ <span id="job-spec-name" style="font-weight: bold; color: #3498db;">ËÅ∑Ê•≠</span>
                                „ÅÆÂ∞ÇÁî®ÁîªÈù¢„Åß„Åô„ÄÇ<br>
                                ÁèæÂú®„ÄÅÊ©üËÉΩ„ÅÆÂÆüË£Ö„ÇíÊ∫ñÂÇô„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ
                            </p>

                            <div id="job-spec-content" style="margin-bottom: 30px;">
                                <!-- ÂÖ±ÈÄö„ÅÆÈÄ≤Êçó„Ç®„É™„Ç¢ (ÂøÖË¶Å„Å´Âøú„Åò„Å¶Ë°®Á§∫) -->
                                <div id="job-common-progress" style="display:none; margin-bottom: 20px;">
                                    <div class="progress-container" style="height: 12px; background: #eee; border-radius: 6px; overflow: hidden;">
                                        <div id="job-progress-bar" style="width: 0%; height: 100%; background: #3498db; transition: width 0.1s linear;"></div>
                                    </div>
                                    <p id="job-status-text" style="font-size: 12px; margin-top: 5px; color: #666;">Ê∫ñÂÇô‰∏≠...</p>
                                </div>

                                <!-- 1. Ê≠¶Âô®ËÅ∑‰∫∫: „Ç≤„Éº„Ç∏Èï∑Êäº„Åó -->
                                <div id="blacksmith-ui" style="display:none;">
                                    <div class="job-module">
                                        <h4>Ê≠¶Âô®ÈçõÈå¨</h4>
                                        <div class="craft-gauge-area" style="position: relative; height: 40px; background: #eee; border-radius: 20px; margin: 20px 0; overflow: hidden; border: 2px solid #333;">
                                            <div id="bs-target-zone" style="position: absolute; height: 100%; width: 15%; left: 75%; background: #2ecc71; opacity: 0.6;"></div>
                                            <div id="bs-current-gauge" style="position: absolute; height: 100%; width: 0%; left: 0; background: #e67e22;"></div>
                                        </div>
                                        <p style="font-size: 11px; color:#c0392b;">„ÄêÈï∑Êäº„Åó„ÄëÁõÆÊ®ô„Çæ„Éº„É≥„ÇíÁõÆÊåá„Åó„Å¶„Ç≤„Éº„Ç∏„ÇíÊ∫ú„ÇÅ„ÇçÔºÅ</p>
                                        <button id="btn-bs-action" onmousedown="startBsGauge()" onmouseup="endBsGauge()" ontouchstart="startBsGauge()" ontouchend="endBsGauge()"
                                            style="padding: 15px 40px; font-size: 18px; background: #e67e22; color: white; border: none; border-radius: 30px; cursor: pointer; font-weight: bold; user-select: none;">
                                            Èçõ„Åà„ÇãÔºÅ
                                        </button>
                                    </div>
                                </div>

                                <!-- 2. Èò≤ÂÖ∑ËÅ∑‰∫∫: „É™„Ç∫„É†„ÇØ„É™„ÉÉ„ÇØ -->
                                <div id="armorsmith-ui" style="display:none;">
                                    <div class="job-module">
                                        <h4>Èò≤ÂÖ∑ÊàêÂΩ¢</h4>
                                        <div style="position: relative; height: 60px; background: #34495e; border-radius: 10px; margin: 20px 0; overflow: hidden;">
                                            <div id="as-beat-line" style="position: absolute; height: 100%; width: 20px; left: 50%; transform: translateX(-50%); border-left: 2px dashed #fff; border-right: 2px dashed #fff; background: rgba(255,255,255,0.1);"></div>
                                            <div id="as-cursor" style="position: absolute; height: 100%; width: 8px; left: 0%; background: #f1c40f; box-shadow: 0 0 10px #f1c40f;"></div>
                                        </div>
                                        <p style="font-size: 11px; color:#c0392b;">ÊµÅ„Çå„Å¶„Åè„ÇãÂÖâ„Åå‰∏≠Â§Æ„Å´Êù•„ÅüÁû¨Èñì„Å´Âè©„ÅëÔºÅ</p>
                                        <button onclick="handleAsClick()" style="padding: 15px 40px; font-size: 18px; background: #2980b9; color: white; border: none; border-radius: 30px; cursor: pointer;">
                                            Âè©„ÅèÔºÅ
                                        </button>
                                    </div>
                                </div>

                                <!-- 3. ÈÅìÂÖ∑ËÅ∑‰∫∫: „Çø„Ç§„Éî„É≥„Ç∞ -->
                                <div id="toolsmith-ui" style="display:none;">
                                    <div class="job-module">
                                        <h4>ÈÅìÂÖ∑‰ΩúÊàê</h4>
                                        <div style="background: #2c3e50; color: #2ecc71; padding: 20px; font-family: monospace; font-size: 24px; border-radius: 8px; margin-bottom: 10px; letter-spacing: 4px;">
                                            <span id="ts-word-display">READY</span>
                                        </div>
                                        <input type="text" id="ts-input" placeholder="„Åì„Åì„Å´ÂÖ•Âäõ..." oninput="checkTsInput()"
                                            style="width: 80%; padding: 10px; font-size: 18px; text-align: center; border: 2px solid #bdc3c7; border-radius: 4px;">
                                    </div>
                                </div>

                                <!-- 4. „ÇÆ„É£„Ç∂„É©„Éº (ÁÇ≠Èâ±Â§´/Êé°ÂèñÂÆ∂): ÊîæÁΩÆ -->
                                <div id="gatherer-ui" style="display:none;">
                                    <div class="job-module">
                                        <h4 id="gather-title">Êé°Âèñ‰∏≠...</h4>
                                        <div class="progress-container" style="height: 25px; background: #eee; border-radius: 15px; margin: 20px 0; overflow: hidden; border: 1px solid #ddd;">
                                            <div id="gather-progress" style="width: 0%; height: 100%; background: #27ae60; transition: width 0.1s linear;"></div>
                                        </div>
                                        <div id="gather-log" style="height: 100px; border: 1px solid #eee; border-radius: 4px; padding: 10px; font-size: 12px; overflow-y: auto; background: #fafafa; text-align: left;">
                                            <p style="color:#999;">Êé°Âèñ„ÇíÈñãÂßã„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- 5. „Éï„Ç°„Éº„Éû„Éº (Ëæ≤ÂÆ∂/ÈÖ™Ëæ≤ÂÆ∂): ËÇ≤Êàê -->
                                <div id="farmer-ui" style="display:none;">
                                    <div class="job-module">
                                        <h4 id="farm-title">ËÇ≤Êàê‰∏≠</h4>
                                        <div style="font-size: 50px; margin: 10px 0;" id="farm-emoji">üå±</div>
                                        <div class="progress-container" style="height: 15px; background: #eee; border-radius: 10px; margin: 10px 0; overflow: hidden;">
                                            <div id="farm-progress" style="width: 0%; height: 100%; background: #f1c40f;"></div>
                                        </div>
                                        <p id="farm-status" style="font-size: 14px; margin-bottom: 15px;">ÊàêÈï∑„ÇíÂæÖ„Å£„Å¶„ÅÑ„Åæ„Åô...</p>
                                        <button onclick="handleFarmAction()" id="btn-farm-action"
                                            style="padding: 10px 30px; background: #27ae60; color: white; border: none; border-radius: 20px; cursor: pointer; font-weight: bold;">
                                            ‰∏ñË©±„Çí„Åô„Çã
                                        </button>
                                    </div>
                                </div>

                                <div id="job-result-msg" style="margin-top: 15px; font-weight: bold; min-height: 1.2em; color: #e67e22;"></div>
                            </div>

                            <button onclick="showJobSelection()"
                                style="padding: 10px 20px; background: #95a5a6; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;">
                                Ëª¢ËÅ∑ÁîªÈù¢ÔºàÈñãÁô∫Áî®„ÉÜ„Çπ„ÉàÔºâ„Å∏Êàª„Çã
                            </button>
                        </div>
                    </div>
                </div>

                <div id="screen-equipment" class="screen-content" style="display: none;">
                    <div class="equipment-v2-layout">
                        <!-- 1. ÁèæÂú®„ÅÆË£ÖÂÇô (Â∑¶Âàó) -->
                        <div class="equip-col current-equip">
                            <h3>ÁèæÂú®„ÅÆË£ÖÂÇô</h3>
                            <div id="current-slots-list" class="vertical-slots">
                                <!-- JS„ÅßÂãïÁöÑ„Å´ÁîüÊàê: ÂÖ®12ÈÉ®‰Ωç -->
                            </div>
                        </div>

                        <!-- 2. Â§âÊõ¥ÂÄôË£ú (‰∏≠Â§ÆÂàó) -->
                        <div class="equip-col candidate-list">
                            <h3>Â§âÊõ¥ÂÄôË£ú (<span id="selected-part-name">ÈÉ®‰Ωç„ÇíÈÅ∏Êäû</span>) <button id="btn-debug-clear-inv"
                                    style="font-size:10px; background:red; color:white; border:none; border-radius:3px; cursor:pointer; display:none;">ÂÖ®ÂâäÈô§(Dev)</button>
                            </h3>
                            <div id="candidate-items-container" class="vertical-items">
                                <!-- ÈÅ∏Êäû‰∏≠„ÅÆÈÉ®‰Ωç„Å´Âêà„ÅÜ„Ç§„É≥„Éô„É≥„Éà„É™ÂÜÖ„ÅÆ„Ç¢„Ç§„ÉÜ„É†„ÇíË°®Á§∫ -->
                                <p class="empty-msg">ÈÉ®‰Ωç„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                            </div>
                        </div>

                        <!-- 3. „Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÂãï (Âè≥Âàó) -->
                        <div class="equip-col stat-comparison">
                            <h3>„Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÂãï</h3>
                            <div id="comparison-details" class="comparison-box">
                                <div class="comp-row"><span>HP:</span>
                                    <div><span id="curr-hp">0</span> <span id="diff-hp">--</span></div>
                                </div>
                                <div class="comp-row"><span>STR:</span>
                                    <div><span id="curr-str">0</span> <span id="diff-str">--</span></div>
                                </div>
                                <div class="comp-row"><span>VIT:</span>
                                    <div><span id="curr-vit">0</span> <span id="diff-vit">--</span></div>
                                </div>
                                <div class="comp-row"><span>AGI:</span>
                                    <div><span id="curr-agi">0</span> <span id="diff-agi">--</span></div>
                                </div>
                                <div class="comp-row"><span>INT:</span>
                                    <div><span id="curr-int">0</span> <span id="diff-int">--</span></div>
                                </div>
                                <div class="comp-row"><span>DEX:</span>
                                    <div><span id="curr-dex">0</span> <span id="diff-dex">--</span></div>
                                </div>
                                <div class="comp-row"><span>LUK:</span>
                                    <div><span id="curr-luk">0</span> <span id="diff-luk">--</span></div>
                                </div>
                                <div class="comp-row"><span>ATK:</span>
                                    <div><span id="curr-atk">0</span> <span id="diff-atk">--</span></div>
                                </div>
                                <div class="comp-row"><span>MATK:</span>
                                    <div><span id="curr-matk">0</span> <span id="diff-matk">--</span></div>
                                </div>
                                <div class="comp-row"><span>DEF:</span>
                                    <div><span id="curr-def">0</span> <span id="diff-def">--</span></div>
                                </div>
                                <div class="comp-row"><span>MDEF:</span>
                                    <div><span id="curr-mdef">0</span> <span id="diff-mdef">--</span></div>
                                </div>
                                <div class="comp-row"><span>HIT:</span>
                                    <div><span id="curr-hit">0</span> <span id="diff-hit">--</span></div>
                                </div>
                                <div class="comp-row"><span>EVA:</span>
                                    <div><span id="curr-eva">0</span> <span id="diff-eva">--</span></div>
                                </div>
                                <div class="comp-row"><span>CRI:</span>
                                    <div><span id="curr-cri">0</span> <span id="diff-cri">--</span></div>
                                </div>
                                <div class="comp-row"><span>RES:</span>
                                    <div><span id="curr-res">0</span> <span id="diff-res">--</span></div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>


    <div id="dev-tag"
        style="display:none; position:fixed; top:0; right:0; background:rgba(231, 76, 60, 0.8); color:white; padding:5px 15px; font-size:12px; font-weight:bold; z-index:9999; pointer-events:none; border-bottom-left-radius:8px;">
        DEV MODE</div>

    <script src="js/config.js?v=gcp_v3"></script>
    <script src="js/game.js?v=gcp_v3"></script>
    <script>
        // Áí∞Â¢É„Å´„Çà„ÇãUIË™øÊï¥
        console.log("[System] Initializing UI adjustment...");
        const isStaging = window.location.href.includes('/dev/');
        const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
        
        console.log("[System] Environment:", { isStaging, isLocal, hostname: window.location.hostname });

        if (isStaging || isLocal) {
            document.getElementById('dev-tag').style.display = 'block';
            document.body.style.backgroundColor = '#001a00'; // ÈñãÁô∫Áî®ÔºöÊ∑±„ÅÑÁ∑ë
            const resetSec = document.getElementById('reset-section');
            if (resetSec) resetSec.style.display = 'block';
        } else {
            // Êú¨Áï™Áí∞Â¢É„Åß„ÅØ„Éá„Éê„ÉÉ„Ç∞Ê©üËÉΩ„ÇíÈö†ÂÆπ
            console.log("[System] Production mode.");
            const speedBtn = document.getElementById('debug-speed-btn');
            if (speedBtn) speedBtn.style.display = 'none';
        }
    </script>
</body>

</html>