# GCP版（CheychipR）移行作業チェックリスト

今夜の移行作業をスムーズかつ安全に行うための手順書です。

## 1. 事前準備（完了済み）
- [x] **全ユーザーデータのバックアップ**: `backup_prod_data_before_migration.json` に最新状態を保存済み。
- [x] **コードバリデーション**: `npm run validate` 通過済み。
- [x] **HTML構文エラーの修正**: `index.html` の閉じタグ修正済み。

## 2. 移行作業手順（今夜実施）

### ステップ1: サーバー停止 & メンテナンス表示（推奨）
可能であれば、旧サーバーへのアクセスを制限するか、メンテナンス画面を表示します。これにより、移行中のデータ不整合を防ぎます。

### ステップ2: 最終デプロイの実行
ターミナルで以下のコマンドを実行し、最新のコードをCloud Runへデプロイします。
```bash
python3 scripts/deploy.py
```
※完了後に表示されるURLを控えておいてください。

### ステップ3: Firebase Hostingの設定更新（必要な場合）
もしドメインをFirebase Hostingで管理している場合は、`firebase.json` のリライト先が新しいCloud Runサービスを指しているか最終確認し、デプロイします。
```bash
firebase deploy --only hosting
```

### ステップ4: 動作確認
以下の項目を重点的にチェックします：
- [ ] ログインができるか
- [ ] ゲームのセーブ/ロードが正常に行われるか（Firestore連携）
- [ ] 画像やアセットが正しく読み込まれているか
- [ ] `hikahikarun6206@gmail.com` でログインし、Lv.99のデータが保持されているか

### ステップ5: 切り替え完了
ドメインの向き先を完全に新しい環境へ切り替えます。

## 3. トラブルシューティング
- **ログインできない**: `FIREBASE_SERVICE_ACCOUNT` の権限が正しいか、エミュレーター設定が本番に残っていないか確認。
- **データが古い**: ローカルのキャッシュ（ブラウザ）をクリアして再試行。
- **重大な不具合**: バックアップデータ（`backup_prod_data_before_migration.json`）を使って復元スクリプトを実行。

---
作業中に迷ったことがあれば、いつでも聞いてください！
